generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  STANDART
  MAIN
}

model Profile {
  id String @id @default(uuid())

  name String @unique

  users User[]

  langs Lang[]

  createdAt DateTime @default(now())

  updatedAt DateTime @updatedAt

  texts Text[]
}

model User {
  id String @id @default(uuid())

  email String @unique

  password String

  name String

  lastname String

  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  profileId String

  role UserRole @default(STANDART)

  confirmed Boolean @default(false)

  texts Text[]

  createdAt DateTime @default(now())

  updatedAt DateTime @updatedAt

  refreshTokens RefreshToken[]
}

model RefreshToken {
  token String @unique

  user   User   @relation(fields: [userId], references: [id])
  userId String
}

model Lang {
  id String @id @default(uuid())

  name String

  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  profileId String

  translations Translation[]

  createdAt DateTime @default(now())

  updatedAt DateTime @updatedAt

  @@unique([profileId, name])
}

model Translation {
  id String @id @default(uuid())

  lang   Lang   @relation(fields: [langId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  langId String

  text    Text   @relation(fields: [textKey], references: [id], onDelete: Cascade, onUpdate: Cascade)
  textKey String

  value String

  @@unique([textKey, langId])
}

model Text {
  id  String @id @default(uuid())
  key String

  translations Translation[]

  updatedBy User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId    String

  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  profileId String

  createdAt DateTime @default(now())

  updatedAt DateTime @updatedAt

  @@unique([key, profileId])
}
